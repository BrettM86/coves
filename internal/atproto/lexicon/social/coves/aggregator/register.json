{
  "lexicon": 1,
  "id": "social.coves.aggregator.register",
  "defs": {
    "main": {
      "type": "procedure",
      "description": "Register an existing aggregator DID with this Coves instance. Aggregators must first create their own DID via PLC directory, then call this endpoint to register. Domain ownership is verified via .well-known/atproto-did file.",
      "input": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["did", "domain"],
          "properties": {
            "did": {
              "type": "string",
              "format": "did",
              "description": "DID of the aggregator (did:plc or did:web format)"
            },
            "domain": {
              "type": "string",
              "format": "uri",
              "description": "Domain where the aggregator is hosted (e.g., 'rss-bot.example.com'). Must serve .well-known/atproto-did file containing the DID."
            }
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["did", "handle"],
          "properties": {
            "did": {
              "type": "string",
              "format": "did",
              "description": "DID of the registered aggregator"
            },
            "handle": {
              "type": "string",
              "description": "Handle extracted from DID document"
            },
            "message": {
              "type": "string",
              "description": "Success message with next steps"
            }
          }
        }
      },
      "errors": [
        {
          "name": "InvalidDID",
          "description": "DID format is invalid or not did:plc or did:web format"
        },
        {
          "name": "DomainVerificationFailed",
          "description": "Could not verify domain ownership via .well-known/atproto-did or DID mismatch"
        },
        {
          "name": "AlreadyRegistered",
          "description": "This aggregator DID is already registered with this instance"
        },
        {
          "name": "DIDResolutionFailed",
          "description": "Could not resolve DID document to extract handle and PDS URL"
        },
        {
          "name": "RegistrationFailed",
          "description": "Internal server error occurred during registration"
        }
      ]
    }
  }
}
